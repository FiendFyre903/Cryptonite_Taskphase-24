# Baby Game 2

**Flag:** `picoCTF{gamer_jump1ng_4r0unD_d0bed747}`

- **step 1**

    Once again, we had to manipulate memory, but this time couldnt just move around directly, had to move at once to not land on memory where parameters for win were stored.

    By subtracting the difference between the memory of EBP and the return of win function we got 39

    8049709 - 804967e = 709 - 67e = 1801 - 1662 = 39

    the reason we want this is to invoke win ourselves.

    we get an underflow of 39, and we can do that by entering 39 a's after reaching y=-1,x=1 pos

    after reaching, we want the value of the last byte of the target address to be the same as win() return address which is 0x70 as the LSB, 0x70 gives us the character p. 

    So we can use lp command to set player position value to p.

    Then we can press s to safely move to nop and win the game.

    ```
    08049674 <main>:
    8049674:	8d 4c 24 04          	lea    0x4(%esp),%ecx
    8049678:	83 e4 f0             	and    $0xfffffff0,%esp
    804967b:	ff 71 fc             	push   -0x4(%ecx)
    804967e:	55                   	push   %ebp
    804967f:	89 e5                	mov    %esp,%ebp
    8049681:	53                   	push   %ebx
    8049682:	51                   	push   %ecx
    8049683:	81 ec a0 0a 00 00    	sub    $0xaa0,%esp
    8049689:	e8 b2 fa ff ff       	call   8049140 <__x86.get_pc_thunk.bx>
    804968e:	81 c3 72 29 00 00    	add    $0x2972,%ebx
    8049694:	8d 85 60 f5 ff ff    	lea    -0xaa0(%ebp),%eax
    804969a:	50                   	push   %eax
    804969b:	e8 b1 fd ff ff       	call   8049451 <init_player>
    80496a0:	83 c4 04             	add    $0x4,%esp
    80496a3:	8d 85 60 f5 ff ff    	lea    -0xaa0(%ebp),%eax
    80496a9:	50                   	push   %eax
    80496aa:	8d 85 6b f5 ff ff    	lea    -0xa95(%ebp),%eax
    80496b0:	50                   	push   %eax
    80496b1:	e8 6d fb ff ff       	call   8049223 <init_map>
    80496b6:	83 c4 08             	add    $0x8,%esp
    80496b9:	83 ec 08             	sub    $0x8,%esp
    80496bc:	8d 85 60 f5 ff ff    	lea    -0xaa0(%ebp),%eax
    80496c2:	50                   	push   %eax
    80496c3:	8d 85 6b f5 ff ff    	lea    -0xa95(%ebp),%eax
    80496c9:	50                   	push   %eax
    80496ca:	e8 e0 fc ff ff       	call   80493af <print_map>
    80496cf:	83 c4 10             	add    $0x10,%esp
    80496d2:	83 ec 08             	sub    $0x8,%esp
    80496d5:	8d 83 06 d2 ff ff    	lea    -0x2dfa(%ebx),%eax
    80496db:	50                   	push   %eax
    80496dc:	6a 02                	push   $0x2
    80496de:	e8 ad f9 ff ff       	call   8049090 <signal@plt>
    80496e3:	83 c4 10             	add    $0x10,%esp
    80496e6:	e8 85 f9 ff ff       	call   8049070 <getchar@plt>
    80496eb:	88 45 f7             	mov    %al,-0x9(%ebp)
    80496ee:	0f be 45 f7          	movsbl -0x9(%ebp),%eax
    80496f2:	83 ec 04             	sub    $0x4,%esp
    80496f5:	8d 95 6b f5 ff ff    	lea    -0xa95(%ebp),%edx
    80496fb:	52                   	push   %edx
    80496fc:	50                   	push   %eax
    80496fd:	8d 85 60 f5 ff ff    	lea    -0xaa0(%ebp),%eax
    8049703:	50                   	push   %eax
    8049704:	e8 6b fd ff ff       	call   8049474 <move_player>
    8049709:	83 c4 10             	add    $0x10,%esp
    ```

    The win function had a bunch of nops, where we could move our player without causing issues.

    ```
    0804975d <win>:
    804975d:	55                   	push   %ebp
    804975e:	89 e5                	mov    %esp,%ebp
    8049760:	53                   	push   %ebx
    8049761:	83 ec 44             	sub    $0x44,%esp
    8049764:	e8 d7 f9 ff ff       	call   8049140 <__x86.get_pc_thunk.bx>
    8049769:	81 c3 97 28 00 00    	add    $0x2897,%ebx
    804976f:	90                   	nop
    8049770:	90                   	nop
    8049771:	90                   	nop
    8049772:	90                   	nop
    8049773:	90                   	nop
    8049774:	90                   	nop
    8049775:	90                   	nop
    8049776:	90                   	nop
    8049777:	90                   	nop
    8049778:	90                   	nop
    8049779:	83 ec 08             	sub    $0x8,%esp
    804977c:	8d 83 48 e0 ff ff    	lea    -0x1fb8(%ebx),%eax
    8049782:	50                   	push   %eax
    8049783:	8d 83 4a e0 ff ff    	lea    -0x1fb6(%ebx),%eax
    8049789:	50                   	push   %eax
    804978a:	e8 41 f9 ff ff       	call   80490d0 <fopen@plt>
    804978f:	83 c4 10             	add    $0x10,%esp
    8049792:	89 45 f4             	mov    %eax,-0xc(%ebp)
    8049795:	83 7d f4 00          	cmpl   $0x0,-0xc(%ebp)
    8049799:	75 1c                	jne    80497b7 <win+0x5a>
    804979b:	83 ec 0c             	sub    $0xc,%esp
    804979e:	8d 83 54 e0 ff ff    	lea    -0x1fac(%ebx),%eax
    80497a4:	50                   	push   %eax
    80497a5:	e8 06 f9 ff ff       	call   80490b0 <puts@plt>
    80497aa:	83 c4 10             	add    $0x10,%esp
    80497ad:	83 ec 0c             	sub    $0xc,%esp
    80497b0:	6a 00                	push   $0x0
    80497b2:	e8 09 f9 ff ff       	call   80490c0 <exit@plt>
    80497b7:	83 ec 04             	sub    $0x4,%esp
    80497ba:	ff 75 f4             	push   -0xc(%ebp)
    80497bd:	6a 3c                	push   $0x3c
    80497bf:	8d 45 b8             	lea    -0x48(%ebp),%eax
    80497c2:	50                   	push   %eax
    80497c3:	e8 b8 f8 ff ff       	call   8049080 <fgets@plt>
    80497c8:	83 c4 10             	add    $0x10,%esp
    80497cb:	83 ec 0c             	sub    $0xc,%esp
    80497ce:	8d 45 b8             	lea    -0x48(%ebp),%eax
    80497d1:	50                   	push   %eax
    80497d2:	e8 79 f8 ff ff       	call   8049050 <printf@plt>
    80497d7:	83 c4 10             	add    $0x10,%esp
    80497da:	90                   	nop
    80497db:	8b 5d fc             	mov    -0x4(%ebp),%ebx
    80497de:	c9                   	leave
    80497df:	c3                   	ret
    ```

**What I learned:**

1.  How to use objdump to dissassemble executables and find the memory of functions and parameters

2. How to change the return address of a function by manipulating memory

**Other incorrect methods I tried:**

- Lots of random methods that were mostly guesses.

**References**

- None